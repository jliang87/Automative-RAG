import streamlit as st
from typing import Dict

class ContextualHelpSystem:
    """Provides contextual help based on user actions and current state."""

    def __init__(self):
        self.help_content = {
            "mode_selection": {
                "title": "å¦‚ä½•é€‰æ‹©æŸ¥è¯¢æ¨¡å¼ï¼Ÿ",
                "content": """
                **ğŸ“Œ äº‹å®æŸ¥è¯¢**: å½“æ‚¨éœ€è¦å…·ä½“çš„æŠ€æœ¯å‚æ•°æ—¶
                - ä¾‹å¦‚ï¼šåå¤‡ç®±å®¹ç§¯ã€å‘åŠ¨æœºåŠŸç‡ã€æ²¹è€—æ•°æ®

                **ğŸ’¡ åŠŸèƒ½å»ºè®®**: å½“æ‚¨è¯„ä¼°æ˜¯å¦éœ€è¦æŸé¡¹åŠŸèƒ½æ—¶
                - ä¾‹å¦‚ï¼šæ˜¯å¦å€¼å¾—è´­ä¹°è‡ªåŠ¨é©¾é©¶å¥—ä»¶

                **ğŸ§¾ æƒè¡¡åˆ†æ**: å½“æ‚¨åœ¨ä¸¤ä¸ªé€‰æ‹©ä¹‹é—´çŠ¹è±«æ—¶
                - ä¾‹å¦‚ï¼šç‡ƒæ²¹è½¦ vs ç”µåŠ¨è½¦çš„ä¼˜ç¼ºç‚¹

                **ğŸ§© åœºæ™¯åˆ†æ**: å½“æ‚¨æƒ³äº†è§£å®é™…ä½¿ç”¨ä½“éªŒæ—¶
                - ä¾‹å¦‚ï¼šé•¿é€”æ—…è¡Œæ—¶çš„å……ç”µä¾¿åˆ©æ€§

                **ğŸ—£ï¸ å¤šè§’è‰²è®¨è®º**: å½“æ‚¨éœ€è¦å…¨é¢çš„ä¸“ä¸šè§‚ç‚¹æ—¶
                - ä¾‹å¦‚ï¼šä¸åŒä¸“å®¶å¦‚ä½•çœ‹å¾…æŸé¡¹æŠ€æœ¯

                **ğŸ” ç”¨æˆ·è¯„è®º**: å½“æ‚¨æƒ³äº†è§£çœŸå®ç”¨æˆ·åé¦ˆæ—¶
                - ä¾‹å¦‚ï¼šè½¦ä¸»å¯¹æŸä¸ªåŠŸèƒ½çš„çœŸå®è¯„ä»·
                """
            },
            "query_writing": {
                "title": "å¦‚ä½•å†™å‡ºå¥½çš„æŸ¥è¯¢ï¼Ÿ",
                "content": """
                **âœ… å¥½çš„æŸ¥è¯¢ç¤ºä¾‹:**
                - "2023å¹´å®é©¬X5çš„åå¤‡ç®±å®¹ç§¯æ˜¯å¤šå°‘ï¼Ÿ"
                - "ç‰¹æ–¯æ‹‰Model 3ä¸å¥”é©°Cçº§çš„å®‰å…¨é…ç½®å¯¹æ¯”"
                - "å®¶åº­ç”¨æˆ·è´­ä¹°7åº§SUVçš„æ³¨æ„äº‹é¡¹"

                **âŒ é¿å…çš„æŸ¥è¯¢æ–¹å¼:**
                - "æ±½è½¦æ€ä¹ˆæ ·ï¼Ÿ" (å¤ªå®½æ³›)
                - "è¿™ä¸ªå¥½ä¸å¥½ï¼Ÿ" (ç¼ºä¹å…·ä½“ä¿¡æ¯)
                - "ECUå‚æ•°é…ç½®" (è¿‡äºæŠ€æœ¯åŒ–)

                **ğŸ’¡ æå‡æŸ¥è¯¢è´¨é‡çš„æŠ€å·§:**
                1. åŒ…å«å…·ä½“çš„å¹´ä»½å’Œè½¦å‹
                2. æ˜ç¡®æ‚¨æƒ³äº†è§£çš„æ–¹é¢
                3. ä½¿ç”¨æ—¥å¸¸è¯­è¨€è€ŒéæŠ€æœ¯æœ¯è¯­
                4. æä¾›ä½¿ç”¨åœºæ™¯æˆ–éœ€æ±‚èƒŒæ™¯
                """
            },
            "result_interpretation": {
                "title": "å¦‚ä½•ç†è§£åˆ†æç»“æœï¼Ÿ",
                "content": """
                **åŒå±‚ç»“æ„è§£è¯»:**
                - **å®è¯éƒ¨åˆ†**: åŸºäºæ–‡æ¡£çš„ç¡®å®šä¿¡æ¯
                - **æ¨ç†éƒ¨åˆ†**: AIåŸºäºçŸ¥è¯†çš„åˆç†æ¨æµ‹

                **ç›¸å…³åº¦åˆ†æ•°å«ä¹‰:**
                - 0.8+: é«˜åº¦ç›¸å…³ï¼Œç»“æœå¯ä¿¡åº¦é«˜
                - 0.6-0.8: ä¸­ç­‰ç›¸å…³ï¼Œç»“æœæœ‰å‚è€ƒä»·å€¼
                - 0.4-0.6: ä½ç›¸å…³ï¼Œå»ºè®®è°ƒæ•´æŸ¥è¯¢

                **æ¥æºå¤šæ ·æ€§:**
                - å¤šä¸ªæ¥æºæ”¯æŒçš„ä¿¡æ¯æ›´å¯é 
                - æ³¨æ„æŸ¥çœ‹ä¿¡æ¯çš„æ—¶æ•ˆæ€§
                - ä¼˜å…ˆå‚è€ƒå®˜æ–¹å’Œæƒå¨æ¥æº
                """
            }
        }

    def get_contextual_help(self, context: str) -> Dict[str, str]:
        """Get help content for specific context."""
        return self.help_content.get(context, {
            "title": "å¸®åŠ©ä¿¡æ¯",
            "content": "æš‚æ— ç›¸å…³å¸®åŠ©ä¿¡æ¯ã€‚"
        })


def render_contextual_help(context: str):
    """Render contextual help widget."""
    help_system = ContextualHelpSystem()
    help_content = help_system.get_contextual_help(context)

    with st.expander(f"â“ {help_content['title']}"):
        st.markdown(help_content['content'])
